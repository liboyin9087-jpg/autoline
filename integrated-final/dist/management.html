<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI åŠ©ç†å¾Œå°ç®¡ç†</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --success: #22c55e; --error: #ef4444; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; padding: 20px; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { font-size: 1.5rem; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .status-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .indicator { width: 12px; height: 12px; border-radius: 50%; background: #64748b; display: inline-block; margin-right: 8px; }
        .indicator.on { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .indicator.off { background: var(--error); }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 1rem; width: 100%; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        button:disabled { background: #64748b; cursor: not-allowed; }
        #log { font-family: monospace; font-size: 0.85rem; color: #94a3b8; margin-top: 10px; white-space: pre-wrap; }
        .timestamp { font-size: 0.8rem; color: #64748b; text-align: right; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± AI ç³»çµ±ç›£æ§å°</h1>
        
        <div class="card">
            <div class="status-row">
                <span>å¾Œç«¯é€£ç·š (Backend)</span>
                <div><span id="api-status" class="indicator"></span> <span id="api-text">æª¢æ¸¬ä¸­...</span></div>
            </div>
            <div class="status-row">
                <span>å»¶é² (Latency)</span>
                <span id="latency">--- ms</span>
            </div>
            <div class="timestamp" id="last-check">ä¸Šæ¬¡æ›´æ–°: ---</div>
        </div>

        <div class="card">
            <h3>ğŸ¤– AI å›æ‡‰æ¸¬è©¦</h3>
            <p style="font-size:0.9rem; color:#ccc;">ç™¼é€ "Ping" ç¢ºèª Gemini API é‡‘é‘°æ˜¯å¦æ­£å¸¸ã€‚</p>
            <button id="test-btn" onclick="testAI()">ç™¼é€æ¸¬è©¦è«‹æ±‚</button>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const API_URL = window.location.origin + '/api'; // è‡ªå‹•æŠ“å–ç•¶å‰ç¶²åŸŸ

        async function checkHealth() {
            const start = Date.now();
            const statusDot = document.getElementById('api-status');
            const statusText = document.getElementById('api-text');
            
            try {
                const res = await fetch(`${API_URL}/status`); // ä½¿ç”¨æˆ‘å€‘ä¹‹å‰å»ºç«‹çš„ status ç«¯é»
                const data = await res.json();
                const latency = Date.now() - start;

                if (res.ok) {
                    statusDot.className = 'indicator on';
                    statusText.textContent = 'ç·šä¸Š';
                    statusText.style.color = 'var(--success)';
                    document.getElementById('latency').textContent = `${latency} ms`;
                } else {
                    throw new Error('å›æ‡‰é 200 OK');
                }
            } catch (e) {
                statusDot.className = 'indicator off';
                statusText.textContent = 'æ–·ç·š';
                statusText.style.color = 'var(--error)';
                document.getElementById('latency').textContent = '---';
            }
            document.getElementById('last-check').textContent = 'ä¸Šæ¬¡æ›´æ–°: ' + new Date().toLocaleTimeString();
        }

        async function testAI() {
            const btn = document.getElementById('test-btn');
            const log = document.getElementById('log');
            
            btn.disabled = true;
            btn.textContent = "æ¸¬è©¦ä¸­...";
            log.textContent = "æ­£åœ¨å‘¼å« Gemini API...";

            try {
                const res = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: "Hello, é€™æ˜¯ä¸€å€‹ç³»çµ±é€£ç·šæ¸¬è©¦ï¼Œè«‹ç°¡çŸ­å›ç­” OKã€‚", 
                        history: [], 
                        persona: "ç³»ç»Ÿ", 
                        settings: {} 
                    })
                });
                
                const data = await res.json();
                if (data.text) {
                    log.innerHTML = `<span style="color:var(--success)">âœ… æ¸¬è©¦æˆåŠŸï¼</span>\nAI å›æ‡‰: "${data.text}"`;
                } else {
                    log.innerHTML = `<span style="color:var(--error)">âŒ æ¸¬è©¦å¤±æ•—</span>\néŒ¯èª¤: ${JSON.stringify(data)}`;
                }
            } catch (e) {
                log.innerHTML = `<span style="color:var(--error)">âŒ é€£ç·šéŒ¯èª¤</span>\n${e.message}`;
            }
            
            btn.disabled = false;
            btn.textContent = "ç™¼é€æ¸¬è©¦è«‹æ±‚";
        }

        // å•Ÿå‹•æ™‚è‡ªå‹•æª¢æŸ¥ï¼Œä¸¦æ¯ 30 ç§’æ›´æ–°ä¸€æ¬¡
        checkHealth();
        setInterval(checkHealth, 30000);
    </script>
</body>
</html>
