<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI åŠ©ç†å¾Œå°ç®¡ç†</title>
    <style>
        :root { 
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #f8fafc; 
            --success: #22c55e; 
            --error: #ef4444; 
        }
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            padding: 20px; 
            margin: 0; 
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
        }
        h1 { 
            font-size: 1.5rem; 
            border-bottom: 1px solid #334155; 
            padding-bottom: 10px; 
        }
        .card { 
            background: var(--card); 
            border-radius: 12px; 
            padding: 15px; 
            margin-bottom: 15px; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); 
        }
        .status-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .indicator { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            background: #64748b; 
            display: inline-block; 
            margin-right: 8px; 
            transition: all 0.3s ease;
        }
        .indicator.on { 
            background: var(--success); 
            box-shadow: 0 0 8px var(--success); 
        }
        .indicator.off { 
            background: var(--error); 
        }
        button { 
            background: #3b82f6; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            font-size: 1rem; 
            width: 100%; 
            cursor: pointer; 
            transition: 0.2s; 
            margin-top: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        button:active { 
            transform: scale(0.98); 
        }
        button:disabled { 
            background: #64748b; 
            cursor: not-allowed; 
        }
        #log { 
            font-family: 'Courier New', monospace; 
            font-size: 0.85rem; 
            color: #94a3b8; 
            margin-top: 10px; 
            white-space: pre-wrap; 
            max-height: 300px;
            overflow-y: auto;
            background: #0f172a;
            padding: 10px;
            border-radius: 8px;
        }
        .timestamp { 
            font-size: 0.8rem; 
            color: #64748b; 
            text-align: right; 
        }
        .success-text {
            color: var(--success);
        }
        .error-text {
            color: var(--error);
        }
        .info-text {
            color: #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± AI ç³»çµ±ç›£æ§å°</h1>
        
        <div class="card">
            <h3>ğŸ”Œ é€£ç·šç‹€æ…‹</h3>
            <div class="status-row">
                <span><span class="indicator" id="server-indicator"></span>å¾Œç«¯ä¼ºæœå™¨</span>
                <span id="server-status">æª¢æŸ¥ä¸­...</span>
            </div>
            <div class="status-row">
                <span><span class="indicator" id="api-indicator"></span>API ç«¯é»</span>
                <span id="api-status">æª¢æŸ¥ä¸­...</span>
            </div>
            <div class="status-row">
                <span><span class="indicator" id="key-indicator"></span>API é‡‘é‘°</span>
                <span id="key-status">æª¢æŸ¥ä¸­...</span>
            </div>
            <div class="timestamp" id="last-check">æœ€å¾Œæª¢æŸ¥: --</div>
        </div>

        <div class="card">
            <h3>ğŸ§ª æ¸¬è©¦åŠŸèƒ½</h3>
            <button id="test-health" onclick="testHealth()">æ¸¬è©¦å¥åº·ç«¯é»</button>
            <button id="test-status" onclick="testStatus()">æ¸¬è©¦ç‹€æ…‹ç«¯é»</button>
            <button id="test-chat" onclick="testChat()">æ¸¬è©¦èŠå¤© API</button>
            <button id="refresh" onclick="checkAll()">ğŸ”„ é‡æ–°æª¢æŸ¥å…¨éƒ¨</button>
        </div>

        <div class="card">
            <h3>ğŸ“‹ ç³»çµ±æ—¥èªŒ</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        let logContent = '';

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('zh-TW');
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            const className = type === 'success' ? 'success-text' : type === 'error' ? 'error-text' : 'info-text';
            logContent = `<span class="${className}">[${timestamp}] ${icon} ${message}</span>\n` + logContent;
            document.getElementById('log').innerHTML = logContent;
        }

        async function testHealth() {
            addLog('æ¸¬è©¦ /api/health ç«¯é»...', 'info');
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                if (response.ok) {
                    addLog(`å¥åº·æª¢æŸ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
                } else {
                    addLog(`å¥åº·æª¢æŸ¥å¤±æ•—: ${response.status}`, 'error');
                }
            } catch (e) {
                addLog(`å¥åº·æª¢æŸ¥éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        async function testStatus() {
            addLog('æ¸¬è©¦ /api/status ç«¯é»...', 'info');
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                if (response.ok) {
                    addLog(`ç‹€æ…‹æŸ¥è©¢æˆåŠŸ: ${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    addLog(`ç‹€æ…‹æŸ¥è©¢å¤±æ•—: ${response.status}`, 'error');
                }
            } catch (e) {
                addLog(`ç‹€æ…‹æŸ¥è©¢éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        async function testChat() {
            addLog('æ¸¬è©¦ /api/chat ç«¯é»...', 'info');
            const testPayload = {
                contents: [
                    { role: 'user', parts: [{ text: 'ä½ å¥½ï¼Œé€™æ˜¯æ¸¬è©¦è¨Šæ¯' }] }
                ],
                systemInstruction: 'è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”',
                maxOutputTokens: 100
            };
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testPayload)
                });
                
                const data = await response.json();
                if (response.ok) {
                    addLog(`èŠå¤© API æˆåŠŸ: ${data.reply ? data.reply.substring(0, 50) + '...' : 'ç„¡å›æ‡‰'}`, 'success');
                } else {
                    addLog(`èŠå¤© API å¤±æ•—: ${response.status} - ${JSON.stringify(data)}`, 'error');
                }
            } catch (e) {
                addLog(`èŠå¤© API éŒ¯èª¤: ${e.message}`, 'error');
            }
        }

        async function checkAll() {
            addLog('é–‹å§‹å…¨é¢æª¢æŸ¥...', 'info');
            document.getElementById('last-check').textContent = `æœ€å¾Œæª¢æŸ¥: ${new Date().toLocaleString('zh-TW')}`;
            
            // æª¢æŸ¥å¥åº·ç«¯é»
            try {
                const healthRes = await fetch('/api/health');
                const serverIndicator = document.getElementById('server-indicator');
                const serverStatus = document.getElementById('server-status');
                
                if (healthRes.ok) {
                    serverIndicator.className = 'indicator on';
                    serverStatus.innerHTML = '<span class="success-text">âœ… æ­£å¸¸</span>';
                } else {
                    serverIndicator.className = 'indicator off';
                    serverStatus.innerHTML = '<span class="error-text">âŒ ç•°å¸¸</span>';
                }
            } catch (e) {
                document.getElementById('server-indicator').className = 'indicator off';
                document.getElementById('server-status').innerHTML = '<span class="error-text">âŒ é€£ç·šå¤±æ•—</span>';
            }

            // æª¢æŸ¥ç‹€æ…‹ç«¯é»
            try {
                const statusRes = await fetch('/api/status');
                const data = await statusRes.json();
                const apiIndicator = document.getElementById('api-indicator');
                const apiStatus = document.getElementById('api-status');
                const keyIndicator = document.getElementById('key-indicator');
                const keyStatus = document.getElementById('key-status');
                
                if (statusRes.ok) {
                    apiIndicator.className = 'indicator on';
                    apiStatus.innerHTML = '<span class="success-text">âœ… æ­£å¸¸</span>';
                    
                    if (data.apiKeyConfigured) {
                        keyIndicator.className = 'indicator on';
                        keyStatus.innerHTML = '<span class="success-text">âœ… å·²è¨­å®š</span>';
                    } else {
                        keyIndicator.className = 'indicator off';
                        keyStatus.innerHTML = '<span class="error-text">âŒ æœªè¨­å®š</span>';
                    }
                } else {
                    apiIndicator.className = 'indicator off';
                    apiStatus.innerHTML = '<span class="error-text">âŒ ç•°å¸¸</span>';
                }
            } catch (e) {
                document.getElementById('api-indicator').className = 'indicator off';
                document.getElementById('api-status').innerHTML = '<span class="error-text">âŒ é€£ç·šå¤±æ•—</span>';
            }

            addLog('å…¨é¢æª¢æŸ¥å®Œæˆ', 'success');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', () => {
            addLog('ç³»çµ±ç›£æ§å°å•Ÿå‹•', 'info');
            checkAll();
        });

        // æ¯ 30 ç§’è‡ªå‹•æª¢æŸ¥
        setInterval(checkAll, 30000);
    </script>
</body>
</html>
